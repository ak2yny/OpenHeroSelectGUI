<Page
    x:Class="OpenHeroSelectGUI.AvailableCharacters"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:settings="using:OpenHeroSelectGUI.Settings"
    mc:Ignorable="d"
    AllowDrop="True"
    DragOver="AvailableCharacters_DragOver"
    DragLeave="AvailableCharacters_DragLeave"
    Drop="AvailableCharacters_Drop"
    KeyboardAcceleratorPlacementMode="Hidden"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.KeyboardAccelerators>
        <KeyboardAccelerator Key="F3" Invoked="TVsearch_Shortcut_Invoked"/>
        <KeyboardAccelerator Modifiers="Control" Key="F" Invoked="TVsearch_Shortcut_Invoked"/>
    </Page.KeyboardAccelerators>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="35"/>
            <RowDefinition Height="35"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <Canvas x:Name="AvailableCharactersDropArea" Grid.RowSpan="3" Background="{ThemeResource ListViewItemPointerOverBackgroundThemeBrush}" Visibility="Collapsed"/>
        <StackPanel Margin="40 5 0 0" Orientation="Horizontal">
            <ToggleButton x:Name="AvailChars" Content="Characters" Click="Avail_Click" FontWeight="Bold"/>
            <ToggleButton x:Name="AvailRstrs" Content="Rosters" Click="Avail_Click" FontWeight="Bold" Visibility="{x:Bind ShowRosters}"/>
            <ToggleButton x:Name="CharsNeedVoice" Content="Need Callout" Click="Avail_Click" FontWeight="Bold" Visibility="{x:Bind IsXvoiceSel}"/>
        </StackPanel>
        <StackPanel Grid.Row="1" Margin="40 0 0 0" Orientation="Horizontal" Spacing="3">
            <AutoSuggestBox x:Name="TVsearch" MinWidth="100" MaxWidth="280" PlaceholderText="Search" QueryIcon="Find" TextChanged="TVsearch_QuerySubmitted"/>
            <!--WIP: If TextChanged doesn't perform well, we should probably change it to QuerySubmitted.-->
            <Button x:Name="BrowseButton" FontWeight="Bold" Click="BrowseButton_Click" Content="..." ToolTipService.ToolTip="Browse for a new herostat to add. Can be a mod archive or a herostat text." Height="35"/>
            <Button x:Name="BtnReload" Click="BtnReload_Click" ToolTipService.ToolTip="F5 | Reload the available characters" Height="35">
                <SymbolIcon Symbol="Refresh"/>
                <Button.KeyboardAccelerators>
                    <KeyboardAccelerator Key="F5" />
                </Button.KeyboardAccelerators>
            </Button>
        </StackPanel>

        <TreeView x:Name="trvAvailableChars"
                  Grid.Row="2"
                  Margin="0 5"
                  CanReorderItems="False"
                  DoubleTapped="TreeViewItem_DoubleTapped"
                  DragItemsStarting="DragItemsStarting"
                  ItemInvoked="OnSelectionChanged"
                  ItemsSource="{x:Bind Cfg.Roster.AvailableTemp}"
                  RightTapped="TreeViewItem_RightTapped"
                  SelectionMode="Single">
            <TreeView.ItemTemplate>
                <DataTemplate x:DataType="settings:AvailableCharacter">
                    <TreeViewItem Content="{x:Bind Content}" ItemsSource="{x:Bind Children}"/>
                    <!--IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}"-->
                </DataTemplate>
            </TreeView.ItemTemplate>
            <TreeView.ItemContainerStyle>
                <Style TargetType="TreeViewItem">
                    <Setter Property="ContextFlyout">
                        <Setter.Value>
                            <MenuFlyout>
                                <MenuFlyoutItem Icon="Copy"   Text="Duplicate file" Click="TreeViewItem_CopyClick"/>
                                <MenuFlyoutItem Icon="Delete" Text="Delete" Click="TreeViewItem_DeleteClick"/>
                                <MenuFlyoutItem Icon="Rename" Text="Rename" Click="TreeViewItem_RenameClick"/>
                                <MenuFlyoutSeparator/>
                                <MenuFlyoutItem Icon="Rename" Text="Rename character name" Click="TreeViewItem_RenameCharClick"/>
                                <!--<MenuFlyoutItem Icon="Rename" Text="Rename internal name" Click="TreeViewItem_RenameInternClick"/>-->
                            </MenuFlyout>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TreeView.ItemContainerStyle>
            <TreeView.KeyboardAccelerators>
                <KeyboardAccelerator Key="Delete" Invoked="TreeViewItems_Delete" ScopeOwner="{x:Bind trvAvailableChars}"/>
            </TreeView.KeyboardAccelerators>
        </TreeView>
        <StackPanel Grid.Row="2" Margin="20" Spacing="2" VerticalAlignment="Bottom">
            <InfoBar x:Name="HSsuccess"
                     Severity="Success"
                     Title="Success"
                     Message="Herostat successfully added."/>
            <InfoBar x:Name="HSinfo"
                     Title="Herostat not found"
                     Message="Herostat not added."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="CopyInfo"
                     Title="Mod installation failed"
                     Message="Mod not added."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="DeleteFailed"
                     Title="File not removed"
                     Message="Couldn't remove associated file."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="RenameFailed"
                     Title="Failed to rename"
                     Message="Not renamed. Nothing changed. Try renaming in file explorer instead."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="RenIntFailed"
                     Title="Failed to rename"
                     Message="Internal names can only contain a-z/A-Z. The picked talents file name must match the old internal name."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="RenPkgFailed"
                     Title="Failed to rename"
                     Message="Not all associated packages could be renamed. Powers won't work correctly."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <ToggleSwitch Toggled="Reload_Available" IsOn="{x:Bind Cfg.Var.PopAvail, Mode=OneWay}" Height="0" MinHeight="0"/>
        </StackPanel>
        <ContentDialog x:Name="EnterNewName"
                       Title="Enter a new name"
                       DefaultButton="Secondary"
                       PrimaryButtonText="Cancel"
                       SecondaryButtonText="OK">
            <TextBox x:Name="NewName">
                <TextBox.KeyboardAccelerators>
                    <KeyboardAccelerator Key="Enter" Invoked="NewName_Entered" ScopeOwner="{x:Bind NewName}"/>
                </TextBox.KeyboardAccelerators>
            </TextBox>
        </ContentDialog>
    </Grid>
</Page>
