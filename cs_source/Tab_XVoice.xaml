<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="OpenHeroSelectGUI.Tab_XVoice"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:OpenHeroSelectGUI"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:lib="using:Zsnd_UI.lib"
    mc:Ignorable="d">

    <Grid>
        <Grid.Resources>
            <DataTemplate x:Key="SoundsTemplate" x:DataType="lib:XVSound">
                <Grid Margin="6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition MaxWidth="104"/>
                        <ColumnDefinition/>
                        <ColumnDefinition MaxWidth="200"/>
                        <ColumnDefinition MaxWidth="100"/>
                    </Grid.ColumnDefinitions>
                    <ComboBox Grid.Column="0" ItemsSource="{x:Bind lib:ZsndEvents.XVprefixes, Mode=OneTime}" SelectedItem="{x:Bind Pref, Mode=TwoWay}" />
                    <TextBox Grid.Column="1" Margin="5 0" Text="{x:Bind IntName}" IsReadOnly="True"/>
                    <!--<TextBlock Grid.Column="2" Text="{x:Bind SampleIndex}" HorizontalAlignment="Right" VerticalAlignment="Center" />-->
                    <Button Grid.Column="2" Content="{x:Bind Sample, Mode=OneWay}" Click="Sample_Click" />
                    <Button Grid.Column="3" Margin="5 0" Content="{x:Bind Flags, Mode=OneWay}" Click="Flags_Click" HorizontalAlignment="Right" />
                </Grid>
            </DataTemplate>
        </Grid.Resources>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition MinWidth="120"/>
        </Grid.ColumnDefinitions>

        <Frame x:Name="AvailableCharactersOrTeams" MaxWidth="400"/>

        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="35"/>
                <RowDefinition Height="35"/>
                <RowDefinition/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <TextBox Height="0" MinHeight="0" IsReadOnly="True" Text="{x:Bind Cfg.Var.FloatingCharacter, Mode=OneWay}" TextChanged="FloatingCharacter_Changed"/>
            <Grid Padding="5 0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <NavigationView x:Name="XVTabs"
                                IsBackButtonVisible="Collapsed"
                                IsBackEnabled="False"
                                Margin="-8"
                                PaneDisplayMode="Top"
                                SelectionChanged="XVTabs_SelectionChanged"
                                IsSettingsVisible="False">
                    <NavigationView.MenuItems>
                        <NavigationViewItem x:Name="XVTab_Characters" Content="Characters" Tag="OpenHeroSelectGUI.AvailableCharacters"/>
                        <NavigationViewItem x:Name="XVTab_Teams" Content="Teams" Tag="OpenHeroSelectGUI.AvailableTeams">
                            <NavigationViewItem.Icon>
                                <PathIcon Data="{StaticResource TEIcon}"/>
                            </NavigationViewItem.Icon>
                        </NavigationViewItem>
                    </NavigationView.MenuItems>
                </NavigationView>
                <Button Grid.Column="1" Content="Load..." Click="LoadX_Click" ToolTipService.ToolTip="Load a different x_voice from a file." />
                <Button Grid.Column="2" Content="Save" Click="Save_Click" ToolTipService.ToolTip="Save the x_voice information to use it in the future." />
                <Button Grid.Column="3" Content="Apply" Click="Apply_Click" ToolTipService.ToolTip="Compile the x_voice to the game or mod folder, to use it in the game." x:Name="ApplyButton" />
            </Grid>
            <AutoSuggestBox x:Name="XVsearch" Grid.Row="1" Margin="5 0" MinWidth="100" PlaceholderText="Search" QueryIcon="Find" TextChanged="XVsearch_QuerySubmitted"/>
            <!--WIP: TextChanged doesn't perform well, we should probably change it to QuerySubmitted. (Kept it for consistency)-->
            <ScrollView Grid.Row="2">
                <ListView x:Name="XVoiceList"
                          Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                          AllowDrop="True"
                          DragOver="XVoiceList_DragOver"
                          Drop="XVoiceList_Drop"
                          KeyboardAcceleratorPlacementMode="Hidden"
                          Margin="5"
                          ItemsSource="{x:Bind FilteredXVSounds}"
                          ItemTemplate="{StaticResource SoundsTemplate}">
                    <ListView.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Delete" Invoked="XVoiceList_Delete" ScopeOwner="{x:Bind XVoiceList}"/>
                    </ListView.KeyboardAccelerators>
                </ListView>
            </ScrollView>
            <StackPanel Grid.Row="3" Margin="5 -4 5 5">
                <InfoBar x:Name="SearchTooMany"
                         Title="Too Many Results"
                         Message="The search yielded too many results to display. Please refine your search.">
                    <InfoBar.Content>
                        <ProgressBar IsIndeterminate="True" Margin="0 0 50 10"/>
                    </InfoBar.Content>
                </InfoBar>
                <InfoBar x:Name="NotAnXvoice"
                         Title="Not an x_voice"
                         Message="The loaded sounds don't come from a file that matches the x_voice name. Sound details will likely be lacking."
                         Severity="Warning"/>
                <InfoBar x:Name="AppliedSuccess"
                         Title="X_voice Successfully Applied"
                         Severity="Success"/>
                <InfoBar x:Name="ApplyRunning"
                         Title="Applying x_voice..."
                         Message="Wait for the x_voice to be updated."
                         IsClosable="False">
                    <InfoBar.Content>
                        <ProgressBar IsIndeterminate="True" Margin="0 0 50 10"/>
                    </InfoBar.Content>
                </InfoBar>
                <InfoBar x:Name="NotLoadedError"
                         Title="X_voice Not Loaded"
                         Message="There are currently no sounds loaded. Please add an x_voice package to the OHS/mua or OHS/xml2 folder or load an x_voice file."
                         Severity="Error"/>
                <InfoBar x:Name="NotAppliedError"
                         Title="X_voice Not Saved/Applied"
                         Severity="Error"/>
            </StackPanel>
            <ContentDialog x:Name="ViewSoundFlags" Title="Ingame Sound Options" PrimaryButtonText="OK">
                <StackPanel DataContext="{Binding SelectedItem, ElementName=XVoiceList}">
                    <TextBlock Text="Don't change, except for experimenting or if known." TextWrapping="Wrap" Margin="0 0 0 10"/>
                    <CheckBox IsChecked="{Binding F1, Mode=TwoWay}" Content="Unknown Option 1"/>
                    <CheckBox IsChecked="{Binding F2, Mode=TwoWay}" Content="Unknown Option 2"/>
                    <CheckBox IsChecked="{Binding F3, Mode=TwoWay}" Content="Unknown Option 3"/>
                    <CheckBox IsChecked="{Binding F4, Mode=TwoWay}" Content="Unknown Option 4"/>
                    <CheckBox IsChecked="{Binding F5, Mode=TwoWay}" Content="Unknown Option 5"/>
                    <CheckBox IsChecked="{Binding F6, Mode=TwoWay}" Content="Unknown Option 6" Margin="0 10 0 0"/>
                    <CheckBox IsChecked="{Binding F7, Mode=TwoWay}" Content="Unknown Option 7"/>
                    <CheckBox IsChecked="{Binding F8, Mode=TwoWay}" Content="Unknown Option 8"/>
                </StackPanel>
            </ContentDialog>
            <ContentDialog x:Name="AddSample" Title="Add Sound File (Sample)" PrimaryButtonText="OK">
                <StackPanel DataContext="{Binding SelectedItem, ElementName=XVoiceList}">
                    <!--<TextBlock Text="temp" TextWrapping="Wrap" Margin="0 0 0 10"/>-->
                    <Grid CornerRadius="3" Height="200">
                        <Grid AllowDrop="True" DragEnter="SampleDropArea_DragEnter">
                            <Canvas Background="Transparent"/>
                            <Rectangle Margin="10" RadiusX="3" RadiusY="3" Stroke="{ThemeResource SystemAccentColor}" StrokeDashArray="6 3" StrokeThickness="3"/>
                            <TextBlock Text="Drop sound file here" TextAlignment="Center" TextWrapping="Wrap" Foreground="Gray" HorizontalAlignment="Center" Margin="15" VerticalAlignment="Center"/>
                        </Grid>
                        <Grid x:Name="SampleDropArea" AllowDrop="True" DragOver="SampleDropAreaBG_DragOver" DragLeave="SampleDropAreaBG_DragLeave" Drop="SampleDropAreaBG_Drop" Visibility="Collapsed">
                            <Canvas Background="{ThemeResource ListViewItemPointerOverBackgroundThemeBrush}"/>
                            <TextBlock Text="Drop sound file here" TextAlignment="Center" TextWrapping="Wrap" Foreground="Gray" HorizontalAlignment="Center" Margin="15" VerticalAlignment="Center"/>
                        </Grid>
                    </Grid>
                    <ComboBox Grid.Column="0" Header="Or select a sample below:" DisplayMemberPath="File" ItemsSource="{x:Bind lib:ZsndLists.Samples, Mode=OneWay}" SelectedIndex="{Binding SampleIndex, Mode=TwoWay}" />
                    <Button Click="Play_Click" Margin="0 5">
                        <StackPanel Orientation="Horizontal">
                            <SymbolIcon>Play</SymbolIcon>
                            <TextBlock Text="Play Sound" Margin="10 0"/>
                        </StackPanel>
                    </Button>
                    <InfoBar x:Name="FileIncompatible"
                             Title="File Not Added"
                             Message="The File could not be added, because it's incompatible or there was an access error."
                             Severity="Error"/>
                    <InfoBar x:Name="FileMaxReached"
                             Title="File Not Added"
                             Message="The File could not be added, because the list is already at its maximum capacity (65536 files)."
                             Severity="Error"/>
                    <InfoBar x:Name="SoundNotPlayed"
                             Title="Sound Could Not Be Played"
                             Message="Corrupted or unsupported file or access error."
                             Severity="Warning"/>
                </StackPanel>
            </ContentDialog>
        </Grid>
    </Grid>
</Page>
