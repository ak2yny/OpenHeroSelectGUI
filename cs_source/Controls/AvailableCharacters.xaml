<UserControl
    x:Class="OpenHeroSelectGUI.Controls.AvailableCharacters"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:OpenHeroSelectGUI.Controls"
    xmlns:settings="using:OpenHeroSelectGUI.Settings"
    mc:Ignorable="d"
    AllowDrop="True"
    DragOver="AvailableCharacters_DragOver"
    DragLeave="AvailableCharacters_DragLeave"
    Drop="AvailableCharacters_Drop">

    <Grid>
        <Canvas x:Name="AvailableCharactersDropArea" Background="{ThemeResource ListViewItemPointerOverBackgroundThemeBrush}" Margin="-40 -100 0 -5"  Visibility="Collapsed"/>
        <TreeView x:Name="trvAvailableChars" Margin="-10 0 0 0"
                  CanReorderItems="False"
                  DoubleTapped="TreeViewItem_DoubleTapped"
                  DragItemsStarting="DragItemsStarting"
                  ItemInvoked="OnSelectionChanged"
                  ItemsSource="{x:Bind Cfg.Roster.AvailableFiltered}"
                  KeyboardAcceleratorPlacementMode="Hidden"
                  RightTapped="TreeViewItem_RightTapped"
                  SelectionMode="Single">
            <TreeView.ItemTemplate>
                <DataTemplate x:DataType="settings:AvailableCharacter">
                    <TreeViewItem Content="{x:Bind Content.Name}" ItemsSource="{x:Bind Children}"/>
                    <!--IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}"-->
                </DataTemplate>
            </TreeView.ItemTemplate>
            <TreeView.ItemContainerStyle>
                <Style TargetType="TreeViewItem">
                    <Setter Property="ContextFlyout">
                        <Setter.Value>
                            <MenuFlyout>
                                <MenuFlyoutItem Icon="Copy"   Text="Duplicate herostat" Click="TreeViewItem_CopyClick"/>
                                <MenuFlyoutItem Icon="Delete" Text="Delete" Click="TreeViewItem_DeleteClick"/>
                                <MenuFlyoutItem Icon="Rename" Text="Rename" Click="TreeViewItem_RenameClick"/>
                                <MenuFlyoutSeparator/>
                                <MenuFlyoutItem Icon="Edit"   Text="Rename character name" Click="TreeViewItem_RenameCharClick"/>
                                <!--<MenuFlyoutItem Icon="Rename" Text="Rename internal name" Click="TreeViewItem_RenameInternClick"/>-->
                            </MenuFlyout>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TreeView.ItemContainerStyle>
            <TreeView.KeyboardAccelerators>
                <KeyboardAccelerator Key="Delete" Invoked="TreeViewItems_Delete" ScopeOwner="{x:Bind trvAvailableChars}"/>
            </TreeView.KeyboardAccelerators>
        </TreeView>
        <StackPanel Margin="-20 0 10 5" Spacing="2" VerticalAlignment="Bottom">
            <InfoBar x:Name="HSsuccess"
                     Severity="Success"
                     Title="Success"
                     Message="Herostat successfully added."/>
            <InfoBar x:Name="HSinfo"
                     Title="Herostat not found"
                     Message="Herostat not added."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="CopyInfo"
                     Title="Mod installation failed"
                     Message="Mod not added."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="DeleteFailed"
                     x:Uid="Available_Context_Delete_Fail"
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="RenameFailed"
                     x:Uid="Available_Context_Rename_Fail"
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <!--<InfoBar x:Name="RenIntFailed"
                     Title="Failed to rename"
                     Message="Internal names can only contain a-z/A-Z. The picked talents file name must match the old internal name."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>
            <InfoBar x:Name="RenPkgFailed"
                     Title="Failed to rename"
                     Message="Not all associated packages could be renamed. Powers won't work correctly."
                     Background="{ThemeResource SystemFillColorSolidNeutralBackground}"/>-->
        </StackPanel>
        <ProgressRing x:Name="SearchInProgress" IsActive="{x:Bind Cfg.Roster.AvailFilteringNeedy, Mode=OneWay}" Visibility="{x:Bind Cfg.Roster.AvailFilteringNeedy, Mode=OneWay}"/>
        <controls:TextInputDialog x:Name="EnterNewName"/>
    </Grid>
</UserControl>
