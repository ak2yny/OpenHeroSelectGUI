<UserControl
    x:Class="OpenHeroSelectGUI.Controls.SkinDetailsControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:settings="using:OpenHeroSelectGUI.Settings"
    mc:Ignorable="d"
    Unloaded="SkinDetails_Unloaded">

    <UserControl.Resources>
        <DataTemplate x:Key="SkinTemplate" x:DataType="settings:SkinDetails">
            <UserControl PointerEntered="SkinTemplate_PointerEntered" PointerExited="SkinTemplate_PointerExited">
                <Grid AutomationProperties.Name="SkinDetails">
                    <VisualStateManager.VisualStateGroups>
                        <VisualStateGroup x:Name="HoveringStates">
                            <VisualState x:Name="HoverButtonsHidden" />
                            <VisualState x:Name="HoverButtonsShown">
                                <VisualState.Setters>
                                    <Setter Target="HoverButton.Visibility" Value="Visible" />
                                </VisualState.Setters>
                            </VisualState>
                        </VisualStateGroup>
                    </VisualStateManager.VisualStateGroups>
                    <SwipeControl x:Name="ListViewSwipeContainer" >
                        <SwipeControl.RightItems>
                            <SwipeItems Mode="Execute">
                                <SwipeItem x:Name="DeleteSwipeItem" Background="Red" Command="{x:Bind Command}" CommandParameter="{x:Bind}"/>
                            </SwipeItems>
                        </SwipeControl.RightItems>
                        <Grid VerticalAlignment="Center">
                            <StackPanel x:Name="SkinDetails" Orientation="Horizontal" Spacing="5" VerticalAlignment="Center">
                                <TextBlock x:Name="CharacterNumber" Text="{x:Bind CharNum}" Margin="0 5"/>
                                <TextBox x:Name="SkinNumber" Text="{x:Bind Number, Mode=TwoWay}" MinWidth="36" BeforeTextChanging="SkinNumber_BeforeTextChanging" GotFocus="FocusToSelect" LosingFocus="SkinNumber_LosingFocus"/>
                                <TextBox x:Name="SkinName" Text="{x:Bind Name, Mode=TwoWay}" MinWidth="150" GotFocus="FocusToSelect"/>
                                <Canvas x:Name="SpaceForButton" Background="{ThemeResource AppBarItemBackgroundThemeBrush}" MinWidth="70"/>
                            </StackPanel>
                            <AppBarButton x:Name="HoverButton" Command="{x:Bind Command}" CommandParameter="{x:Bind}" IsTabStop="False" HorizontalAlignment="Right" Visibility="Collapsed"/>
                        </Grid>
                    </SwipeControl>
                </Grid>
            </UserControl>
        </DataTemplate>
        <DataTemplate x:Key="SkinTemplateXML2" x:DataType="settings:SkinDetails">
            <UserControl PointerEntered="SkinTemplate_PointerEntered" PointerExited="SkinTemplate_PointerExited">
                <Grid AutomationProperties.Name="SkinDetails">
                    <VisualStateManager.VisualStateGroups>
                        <VisualStateGroup x:Name="HoveringStates">
                            <VisualState x:Name="HoverButtonsHidden" />
                            <VisualState x:Name="HoverButtonsShown">
                                <VisualState.Setters>
                                    <Setter Target="HoverButton.Visibility" Value="Visible" />
                                </VisualState.Setters>
                            </VisualState>
                        </VisualStateGroup>
                    </VisualStateManager.VisualStateGroups>
                    <SwipeControl x:Name="ListViewSwipeContainer" >
                        <SwipeControl.RightItems>
                            <SwipeItems Mode="Execute">
                                <SwipeItem x:Name="DeleteSwipeItem" Background="Red" Command="{x:Bind Command}" CommandParameter="{x:Bind}"/>
                            </SwipeItems>
                        </SwipeControl.RightItems>
                        <Grid VerticalAlignment="Center">
                            <StackPanel x:Name="SkinDetails" Orientation="Horizontal" Spacing="5" VerticalAlignment="Center">
                                <TextBlock x:Name="CharacterNumber" Text="{x:Bind CharNum}" Margin="0 5"/>
                                <TextBox x:Name="SkinNumber" Text="{x:Bind Number, Mode=TwoWay}" MinWidth="36" BeforeTextChanging="SkinNumber_BeforeTextChanging" GotFocus="FocusToSelect" LosingFocus="SkinNumber_LosingFocus"/>
                                <TextBlock x:Name="SkinNameXML2" Text="{x:Bind Name}" Margin="5" MinWidth="150"/>
                                <Canvas x:Name="SpaceForButton" Background="{ThemeResource AppBarItemBackgroundThemeBrush}" MinWidth="70"/>
                            </StackPanel>
                            <AppBarButton x:Name="HoverButton" Command="{x:Bind Command}" CommandParameter="{x:Bind}" IsTabStop="False" HorizontalAlignment="Right" Visibility="Collapsed"/>
                        </Grid>
                    </SwipeControl>
                </Grid>
            </UserControl>
        </DataTemplate>
        <settings:GameTemplateSelector x:Key="SkinTemplateSelector"
                                       MUA="{StaticResource SkinTemplate}"
                                       XML2="{StaticResource SkinTemplateXML2}"/>
    </UserControl.Resources>

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition x:Name="Header" Height="Auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <StackPanel Margin="10 10 10 0" Spacing="10">
            <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}">
                <Run Text="{x:Bind Stats.CharacterName, Mode=OneWay}"/>
                <Run Text="Skin Details"/>
            </TextBlock>
            <TextBlock x:Name="CharacterPath" Text="{x:Bind Cfg.Var.FloatingCharacter, Mode=OneWay}"/>
        </StackPanel>
        <ScrollViewer Grid.Row="1" Margin="10 0">
            <StackPanel Spacing="10">
                <ListView x:Name="Skins"
                          ItemsSource="{x:Bind Stats.SkinsList}"
                          ItemTemplateSelector="{StaticResource SkinTemplateSelector}"
                          AllowDrop="{x:Bind Cfg.GUI.SkinsCanReorder}"
                          CanDragItems="{x:Bind Cfg.GUI.SkinsCanDragItems}"
                          CanReorderItems="{x:Bind Cfg.GUI.SkinsCanReorder}"
                          DragItemsCompleted="Skins_DragItemsCompleted"
                          SelectionChanged="Skins_SelectionChanged"
                          SelectionMode="Single">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem" BasedOn="{StaticResource DefaultListViewItemStyle}">
                            <Setter Property="Height" Value="56"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
                            <Setter Property="BorderThickness" Value="0"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.KeyboardAccelerators>
                        <KeyboardAccelerator Key="Delete" Invoked="Skins_Delete"/>
                    </ListView.KeyboardAccelerators>
                </ListView>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <StackPanel x:Name="AddButton" Orientation="Horizontal" Visibility="{x:Bind Stats.CanAddSkins, Mode=OneWay}">
                        <TextBlock x:Name="AddCharNum" Text="{x:Bind Stats.CharNum, Mode=OneWay}" Margin="16 0 5 0" VerticalAlignment="Center"/>
                        <Button x:Name="AddSkinSlot" Click="AddSkinSlot_Click" Padding="10 5">
                            <SymbolIcon>Add</SymbolIcon>
                        </Button>
                    </StackPanel>
                    <Button x:Name="SaveSkinDetails" Content="Save" Click="SaveSkinDetails_Click" HorizontalAlignment="Right" IsEnabled="{x:Bind Stats.AnySkins, Mode=OneWay}" Margin="88 0"/>
                </Grid>
            </StackPanel>
        </ScrollViewer>
        <!--Skin Installer-->
        <StackPanel Grid.Column="1" Margin="10 10 10 0" Spacing="10">
            <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" Text="Skin Installer"/>
            <TextBlock><Run Text="{x:Bind Stats.CharNum, Mode=OneWay}"/><Run x:Name="SelectedSkinNumber"/></TextBlock>
        </StackPanel>
        <ScrollViewer Grid.Column="1" Grid.Row="1" Margin="10 0" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="5">
                <ComboBox x:Name="MUAplatforms" Header="Select the target platform:" MinWidth="200" Visibility="{x:Bind Cfg.GUI.IsMua}">
                    <ComboBoxItem Content="PC 2006"/>
                    <ComboBoxItem Content="PS2"/>
                    <ComboBoxItem Content="PS3"/>
                    <ComboBoxItem Content="PS4"/>
                    <ComboBoxItem Content="PSP"/>
                    <ComboBoxItem Content="Wii"/>
                    <ComboBoxItem Content="Xbox"/>
                    <ComboBoxItem Content="Xbox 360"/>
                    <ComboBoxItem Content="Xbox One, Steam"/>
                </ComboBox>
                <ComboBox x:Name="XML2platforms" Header="Select the target platform:" MinWidth="200" Visibility="{x:Bind Cfg.GUI.IsXml2}">
                    <ComboBoxItem Content="PC"/>
                    <ComboBoxItem Content="Gamecube"/>
                    <ComboBoxItem Content="PS2"/>
                    <ComboBoxItem Content="PSP"/>
                    <ComboBoxItem Content="Xbox"/>
                </ComboBox>
                <ComboBox x:Name="TargetPath" Header="Select the target folder or mod:" MinWidth="200"/>
                <TextBlock x:Name="InstallMannequin" Visibility="Collapsed">
                    <Run Text="Install"/>
                    <Run x:Name="MannequinType"/>
                    <Run Text="{x:Bind Stats.CharNum, Mode=OneWay}"/><Run x:Name="MannequinNumber" Text="{x:Bind Stats.MannequinNumber, Mode=OneWay}"/>
                </TextBlock>
                <Button x:Name="InstallMannequinB" Content="Browse ..." Click="InstallMannequin_Click" ToolTipService.ToolTip="Browse for mannequin / CSP" Visibility="Collapsed"/>
                <Grid x:Name="SkinInstallerButtons" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <InfoBar x:Name="AlchemyWarning"
                             Severity="Warning"
                             Title="Alchemy not found."
                             CloseButtonClick="AlchemyWarning_CloseButtonClick"
                             Grid.ColumnSpan="3"
                             MaxWidth="300"
                             ToolTipService.ToolTip="Skin, HUD head, and mannequin optimization is not available.">
                        <InfoBar.ActionButton>
                            <HyperlinkButton Content="Download Alchemy" NavigateUri="https://marvelmods.com/forum/index.php?msg=202243"/>
                        </InfoBar.ActionButton>
                    </InfoBar>
                    <TextBlock x:Name="InstallSkins" Grid.ColumnSpan="3" Grid.Row="1" Margin="0 0 0 5">
                        <Run Text="Install skin"/>
                        <Run Text="{x:Bind Stats.CharNum, Mode=OneWay}"/><Run x:Name="SkinNumber"/><Run Text=":"/>
                    </TextBlock>
                    <Button Grid.Column="0" Grid.Row="2" Content="Skin ..." Click="InstallSkins_Click" ToolTipService.ToolTip="Browse for skin"/>
                    <Button Grid.Column="1" Grid.Row="2" x:Name="HudHeadBrowse" Content="HUD ..." Click="InstallHuds_Click" Margin="5 0" ToolTipService.ToolTip="Browse for HUD head"/>
                    <Button Grid.Column="2" Grid.Row="2" x:Name="Head3D_Browse" Content="3d Head ..." Click="Install3DHead_Click" ToolTipService.ToolTip="Browse for 3D head" Visibility="{x:Bind Cfg.GUI.IsXml2}"/>
                    <TextBlock x:Name="InstallExtraSkin" Grid.ColumnSpan="3" Margin="0 5" Grid.Row="3" Text="Install swap skin:"/>
                    <Button Click="InstallEmmaSkin_Click" Grid.Row="4" Grid.Column="0" Padding="21 5">
                        <ImageIcon Source="/Assets/emmafrost.png"/>
                        <ToolTipService.ToolTip>
                            <ToolTip Opened="DiamondForm_Opened"/>
                        </ToolTipService.ToolTip>
                    </Button>
                    <Button Click="InstallHumanTorch_Click" Grid.Row="4" Grid.Column="1" Margin="5 0" Padding="19 3">
                        <ImageIcon Source="/Assets/humantorch.png"/>
                        <ToolTipService.ToolTip>
                            <ToolTip Opened="FlameOn_Opened"/>
                        </ToolTipService.ToolTip>
                    </Button>
                    <Button Content="Other..." Click="InstallExtraSkin_Click" Grid.Row="4" Grid.Column="2" ToolTipService.ToolTip="Browse for skin for skin swapping (shape changers etc.)"/>
                </Grid>
                <Grid x:Name="SkinInfo" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>
                    <Rectangle Grid.ColumnSpan="2"
                               Fill="{ThemeResource TextBoxBackgroundThemeBrush}"
                               RadiusX="4"
                               RadiusY="4"
                               Style="{ThemeResource ColorPickerBorderStyle}"/>
                    <StackPanel Margin="5 5 0 5">
                        <TextBlock x:Name="SkinInfoTitle" Text="IGB Statistics:" FontWeight="Bold" Foreground="Black"/>
                        <TextBlock x:Name="AlchemyVersionT" Text="Alchemy version:"/>
                        <TextBlock x:Name="FileSizeT" Text="File size:"/>
                        <TextBlock x:Name="GeometryFormatsT" Text="Geometry formats:"/>
                        <TextBlock x:Name="VertexCountT" Text="Vertex count:" Foreground="Black"/>
                        <TextBlock x:Name="GeometryCountT" Text="Geometry count:" Foreground="Green"/>
                        <TextBlock x:Name="TextureFormatsT" Text="Texture formats:"/>
                        <TextBlock x:Name="BiggestTextureT" Text="Biggest texture:" Foreground="Black"/>
                        <TextBlock x:Name="TextureCountT" Text="Texture count:" Foreground="Green"/>
                        <TextBlock x:Name="MipMapsT" Text="Mip-maps count:" Foreground="Green"/>
                        <TextBlock x:Name="igSkinNameT" Text="igSkin name:"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Margin="5">
                        <TextBlock Text=" " FontWeight="Bold"/>
                        <TextBlock x:Name="AlchemyVersion"/>
                        <TextBlock x:Name="FileSize"/>
                        <TextBlock x:Name="GeometryFormats"/>
                        <TextBlock x:Name="VertexCount" Foreground="Black"/>
                        <TextBlock x:Name="GeometryCount" Foreground="Green"/>
                        <TextBlock x:Name="TextureFormats"/>
                        <TextBlock x:Name="BiggestTexture" Foreground="Black"/>
                        <TextBlock x:Name="TextureCount" Foreground="Green"/>
                        <TextBlock x:Name="MipMaps" Foreground="Green"/>
                        <TextBlock x:Name="igSkinName"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </ScrollViewer>
        <ContentDialog x:Name="EnterSkinNumber" Title="Install Extra Skin" PrimaryButtonText="OK" MaxWidth="400">
            <StackPanel>
                <TextBlock Text="Enter the number that the swap skin should be installed to:" TextWrapping="Wrap"/>
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="ExtraCharacterNumber" Text="{x:Bind Stats.CharNum, Mode=OneWay}" Margin="5 10"/>
                    <TextBox x:Name="ExtraSkinNumber" BeforeTextChanging="SkinNumber_BeforeTextChanging" LosingFocus="SkinNumber_LosingFocus" Margin="0 5"/>
                </StackPanel>
                <TextBlock Text="For mods that use skin specific swap out skins in a similar manner as Emma Frost or Human Torch, but with a different numbering system." TextWrapping="Wrap"/>
                <TextBlock Text="Also for morphing, shape changing or certain powers. This is usually not required (e.g. for Mystique), unless you manually want to change the swapped skins." TextWrapping="Wrap"/>
            </StackPanel>
        </ContentDialog>
    </Grid>
</UserControl>
